# Production Readiness Enhancements Plan
# docs/plans/production-readiness-enhancements.md

This document outlines the final steps to make `circular` an enterprise-grade tool, focusing on CI/CD integration, deeper secret scanning, and noise reduction.

## Implementation Status (2026-02-20)

| Phase | Status | Notes |
| :--- | :--- | :--- |
| **Phase 1: SARIF Output** | ❌ Not Implemented | No `internal/ui/report/formats/sarif.go` |
| **Phase 2: Git History Scanning** | ❌ Not Implemented | No `internal/engine/secrets/git_scanner.go` |
| **Phase 3: Generated Code Handling** | ❌ Not Implemented | No header detection or exclusion |

### What's Implemented
- Basic secret detection with pattern matching and entropy
- Multiple output formats (DOT, Mermaid, PlantUML, TSV, Markdown)
- MCP integration for CI/CD workflows

### What's Missing
- SARIF output for GitHub Code Scanning
- Git history secret scanning
- Generated code detection (`DO NOT EDIT` headers)
- Inline `// circular:ignore` comment support

## Objective
Implement SARIF output, Git history scanning, and generated code handling.

## Standards & Best Practices
- **SARIF v2.1.0:** Adhere to the OASIS standard for static analysis results.
- **Git Security:** Do not clone repositories; use local `.git` if present.
- **Noise Reduction:** Never flag issues in code that is explicitly marked as generated.

## Detailed Phase Breakdown

### Phase 1: SARIF Output Support
Implement the industry-standard format for security and quality reporting.

| Task | File | Description |
| :--- | :--- | :--- |
| Create SARIF Generator | `internal/ui/report/formats/sarif.go` | Map cycles and violations to SARIF objects. |
| Add CLI Flag `--sarif` | `cmd/circular/main.go` | Allow users to request SARIF output. |

#### Code Snippet: SARIF Structure
```json
{
  "$schema": "https://schemastore.azurewebsites.net/schemas/json/sarif-2.1.0-rtm.5.json",
  "version": "2.1.0",
  "runs": [
    {
      "tool": { "driver": { "name": "circular" } },
      "results": [
        {
          "ruleId": "CIRC001",
          "message": { "text": "Circular dependency detected" },
          "locations": [ { "physicalLocation": { "artifactLocation": { "uri": "internal/core/app.go" } } } ]
        }
      ]
    }
  ]
}
```

### Phase 2: Git History Secret Scanning
Search for secrets that have been deleted but still exist in the repository history.

| Task | File | Description |
| :--- | :--- | :--- |
| Implement Git Scanner | `internal/engine/secrets/git_scanner.go` | Use `git log -p` to scan historical diffs. |
| Configuration | `circular.toml` | Add `secrets.scan_history = N` commits. |

### Phase 3: Generated Code Handling
Avoid analyzing files that are auto-generated.

| Task | File | Description |
| :--- | :--- | :--- |
| Header Detection | `internal/engine/parser/utils.go` | Detect `DO NOT EDIT` or `Generated by` headers. |
| Exclusion Logic | `internal/engine/graph/graph.go` | Skip analysis for files marked as generated. |

## Do's and Don'ts

| DO | DONT |
| :--- | :--- |
| Use URI-relative paths in SARIF. | Include full absolute paths in shared reports. |
| Limit history scan depth by default. | Run full history scans on massive repos without warning. |
| Support inline `// circular:ignore` comments. | Force users to update config for every minor exception. |

## New Files Purpose

| File | Purpose | Known Functions |
| :--- | :--- | :--- |
| `internal/ui/report/formats/sarif.go` | SARIF format implementation. | `GenerateSARIF` |
| `internal/engine/secrets/git.go` | Git interaction for history scanning. | `ScanGitHistory` |

## Verification Plan
1. **GitHub Actions:** Verify that SARIF output can be uploaded and viewed in GitHub Code Scanning.
2. **Secret Detection:** Create a commit with a secret, delete it in the next commit, and verify `circular` still finds it.
3. **Generated Code:** Verify that Protobuf files are ignored in cycle detection.
