# circular

`circular` is a Go-based dependency monitor for codebases parsed with Tree-sitter language grammars.

It scans source files, builds a module import graph, then reports:
- circular imports
- unresolved symbol references ("hallucinations")
- unused imports
- potential hardcoded secrets
- dependency depth/fan-in/fan-out metrics
- architecture layer-rule violations
- change impact (direct + transitive importers)
- complexity hotspots

It can run once (`--once`) or watch continuously with optional terminal UI mode (`--ui`).

## Disclaimer

This codebase is 100% AI-generated. Use it at your own risk and responsibility.

## Features

- parses `.go` and `.py` files by default, with registry-based opt-in support for `javascript`, `typescript`, `tsx`, `java`, `rust`, `html`, `css`, `gomod`, and `gosum`
- supports runtime Tree-sitter grammar loading via `dlopen` (Linux/macOS) for custom language support without recompilation
- builds and updates a module-level dependency graph
- Detects import cycles across internal modules
- Detects unresolved references using local symbols, imports, stdlib, and builtins
- Treats known cross-language bridge calls (FFI/process/service patterns) as first-class resolver contexts to reduce polyglot false positives
- Supports explicit bridge mappings from `.circular-bridge.toml` to resolve known cross-language links deterministically
- Scores bridge-like references and classifies medium-confidence matches as "probable bridge references" instead of silently marking them resolved
- Builds a universal cross-language symbol table and runs a second-pass probabilistic resolver for ambiguous references
- Persists resolver symbol indexes and graph edges to SQLite (`symbols` table) with incremental per-file upsert/delete updates and a memory-bounded LRU cache
- Uses a `sync.Pool`-backed Tree-sitter parser instance pool to dramatically reduce per-file allocation overhead
- Adds framework-aware service contract linking heuristics (for example gRPC/Thrift-style client/server symbol families)
- Detects unused imports and appends findings to TSV output
- Detects potential hardcoded secrets via built-in patterns + entropy/context heuristics, including line-range incremental scanning for changed hunks in watch mode
- Gates entropy checks to high-risk file extensions (`.env`, `.json`, `.key`, `.pem`, `.p12`, `.pfx`, `.crt`, `.cer`, `.yaml`, `.yml`, `.toml`, `.ini`, `.conf`, `.properties`)
- Supports unused-import suppression via `exclude.imports` for known false-positive paths
- Applies language-scoped resolver policies for `go`, `python`, `javascript`/`typescript`/`tsx`, `java`, and `rust`
- Disables unused-import checks for unsupported/metadata-only languages to reduce false positives
- Computes module dependency metrics (depth, fan-in, fan-out)
- Traces shortest import chain between modules (`--trace`)
- Analyzes blast radius for a file/module (`--impact`)
- Validates optional architecture layer rules
- Reports top complexity hotspots from parser heuristics and calculates module `ImportanceScore`
- Generates C4-style architecture diagrams with edge aggregation
- Generates interactive D3 HTML treemaps for codebase visualization
- Generates Mermaid sequence diagrams for call-graph tracing
- Captures enriched definition metadata (visibility, scope, signature, decorators/type hints) across Go/Python/JavaScript/TypeScript/Java/Rust definitions
- Provides an advanced read-only CQL parser/executor in `internal/data/query` (`SELECT modules WHERE ...`) for power-user graph queries
- Emits outputs:
  - Graphviz DOT (`graph.dot` by default)
  - TSV edge list (`dependencies.tsv` by default)
  - Mermaid module dependency diagram (`graph.mmd`, optional)
  - PlantUML module dependency diagram (`graph.puml`, optional)
  - Markdown analysis report (`analysis-report.md`, optional)
  - **SARIF v2.1.0 report** (`output.sarif` or `--sarif <path>`, optional) — compatible with GitHub Code Scanning
  - Marker-based Markdown diagram injection (optional)
- **Git history secret scanning**: scan the last N commits for deleted secrets with `--scan-history N` or `secrets.scan_history` in config; findings use synthetic paths (`git:history:<commit>:<file>`)
- **Generated code exclusion**: automatically skips files matching common generation markers (`DO NOT EDIT`, `@generated`, `Code generated by`, etc.) and files containing `// circular:ignore`
- **Enhanced Observability**: Prometheus metrics (`/metrics`) and OpenTelemetry tracing support for performance and health monitoring
- **Dynamic Configuration**: Supports environment variable overrides (`CIRCULAR_[SECTION]_[KEY]`) and hot-reloading of configuration files during watch/MCP sessions
- **Robust Validation**: Exhaustive configuration and MCP input validation with aggregated error reporting and path sanitization
- **Rate Limiting**: Built-in protection for MCP server (stdio and SSE) with weighted operation costs and per-IP throttling
- MCP runtime with stdio and **SSE (HTTP)** JSON-RPC tool protocol support and allowlisted operations
  - includes secret operations: `secrets.scan`, `secrets.list`
- Live filesystem watch mode with debounce
- Optional Bubble Tea terminal UI for live issue monitoring
- Grammar provenance manifest verification (`grammars/manifest.toml`) with `--verify-grammars`
- Configuration dry-run check with `--check`

## Runtime Modes

- default (watch mode): run initial scan, print summary, write outputs, then watch for changes
- `--once`: run initial scan + analysis once, then exit
- `--trace <from-module> <to-module>`: print shortest internal import chain, then exit
- `--impact <file-or-module>`: print direct/transitive importer impact, then exit
- `--report-md`: force markdown report generation (`output.markdown` path or `analysis-report.md`)
- `--ui`: run watch mode with Bubble Tea UI
- MCP mode: set `[mcp].enabled=true` in config to start the MCP runtime (CLI modes are disabled)
- OpenAPI conversion uses `mcp.openapi_spec_path` or `mcp.openapi_spec_url` (mutually exclusive), validates with `kin-openapi`, and applies `mcp.operation_allowlist`

## Install / Build

Requirements:
- Go `1.24+` supported
- Go `1.23` is not supported by current dependencies
- `go.mod` pins `go 1.24`

Build:

```bash
go build -o circular ./cmd/circular
```

Run tests:

```bash
go test ./...
```

## Versioning

This project follows Semantic Versioning: `MAJOR.MINOR.PATCH`.

- `PATCH`: backward-compatible bug fixes and internal improvements with no public contract change.
- `MINOR`: backward-compatible features (for example new CLI flags, additive config fields, additive output fields).
- `MAJOR`: breaking changes to CLI behavior/flags, config schema, or output formats that downstream tooling relies on.

Before a version bump/release:
- Update root `CHANGELOG.md` with user-facing changes.
- Keep docs in `docs/documentation/` aligned with released behavior.

## Hexagonal Refactor Status

The hexagonal architecture migration plan is tracked in:
- `docs/plans/hexagonal-architecture-refactor.md`

Current status (as of 2026-02-14):
- Phase 1 (driven ports): complete
- Phase 2 (domain service split): complete (`internal/core/app/service.go` exposes `AnalysisService`, and output/report + summary compatibility behavior is extracted to `internal/core/app/presentation_service.go`)
- Phase 3 (driven adapters): complete (parser + history + secrets adapters implemented and wired through ports)
- Phase 4 (driving adapters): complete (CLI/TUI/MCP runtime flows route through `AnalysisService` driving ports; startup uses interface-first analysis factory wiring; parity tests cover summary/output contract equivalence)

Estimated completion (session 11):
- Phase 1: `100%`
- Phase 2: `100%`
- Phase 3: `100%`
- Phase 4: `100%`

Plan fully implemented: `yes`.

## Advanced Architecture Refinements Status

The advanced refinements plan is tracked in:
- `docs/plans/advanced-architecture-refinements.md`

Current status (as of 2026-02-14):
- Phase 1 (persistent symbol table): complete
- Phase 2 (incremental + risk-filtered secret scanning): complete
- Phase 3 (explicit cross-language bridges): complete
- Phase 1 (persistent symbol table): complete (Schema v4 with `confidence`/`ancestry`/`usage_tag`)
- Phase 2 (incremental + risk-filtered secret scanning): complete
- Phase 3 (explicit cross-language bridges): complete
- Phase 4 (read-only CQL): complete
- Phase 5 (Batch Writer + Universal Parser): complete (`writer.go`, `universal.go`)
- Phase 6 (AI Overlays + Surgical API): complete (`overlays`, `surgical.go`)

Plan fully implemented: `yes`.

## Scalability & Memory Optimization Status

The scalability and memory optimization plan is tracked in:
- `docs/plans/archived/scalability-memory-optimization.md`

Current status (as of 2026-02-20):
- Phase 1 (LRU Graph Node Cache + Storage Port): complete
- Phase 2 (Paginated MCP Tool Responses): complete
- Phase 3 (Parser Pool & SQLite Tuning): complete

Plan fully implemented: `yes`.

## Production Readiness Enhancements Status

The production readiness enhancements plan is tracked in:
- `docs/plans/production-readiness-enhancements.md`

Current status (as of 2026-02-20):
- Phase 1 (SARIF output): complete (`internal/ui/report/formats/sarif.go`)
- Phase 2 (Git history secret scanning): complete (`internal/engine/secrets/git_scanner.go`)
- Phase 3 (Generated code detection and exclusion): complete (`internal/engine/parser/generated.go`)

Plan fully implemented: `yes`.

## Dynamic Grammar Support Status

The dynamic grammar support plan is tracked in:
- `docs/plans/dynamic-grammar-support.md`

Current status (as of 2026-02-14):
- Phase 1 (dynamic loader): complete
- Phase 2 (configuration mapping): complete
- Phase 3 (generic dynamic extractor): complete

Estimated completion (session 1):
- Phase 1: `100%`
- Phase 2: `100%`
- Phase 3: `100%`

Plan fully implemented: `yes`.

## Quick Start

1. Review default config:

```bash
cat data/config/circular.toml
```

2. Update `watch_paths` in `data/config/circular.toml` to your target project paths if needed.

3. Run a one-time scan:

```bash
go run ./cmd/circular --once
```

4. Run in watch mode:

```bash
go run ./cmd/circular
```

5. Run in UI mode:

```bash
go run ./cmd/circular --ui
```

## MCP Quick Start

1. Enable MCP in config (`data/config/circular.toml`):

```toml
[mcp]
enabled = true
allow_mutations = true
operation_allowlist = ["scan.run", "secrets.scan", "secrets.list", "graph.cycles", "graph.sync_diagrams", "query.modules", "query.module_details", "query.trace", "system.sync_config", "system.select_project", "query.trends", "report.generate_markdown"]
```

2. Send a request over stdio:

```bash
cat <<'JSON' | go run ./cmd/circular --config data/config/circular.toml
{"id":"1","tool":"circular","args":{"operation":"query.modules","params":{"limit":5}}}
JSON
```

See `docs/documentation/mcp.md` for the full protocol and operation list.
For multi-client usage via systemd socket activation, see `docs/documentation/mcp.md`.

## Refresh Diagrams

Run a one-time scan to refresh generated diagram artifacts and markdown injections:

```bash
go run ./cmd/circular --config data/config/circular.toml --once
```

## Diagram Scope

Mermaid and PlantUML outputs support dedicated diagram modes:
- dependency view (default)
- architecture view (`output.diagrams.architecture=true`)
- component view (`output.diagrams.component=true`)
- flow view (`output.diagrams.flow=true`)

Dedicated architecture/component/flow diagram modes are tracked in:
- `docs/plans/diagram-expansion-plan.md`
- `docs/plans/cross-platform-compatibility-plan.md` (session status includes whether the plan is fully implemented)

Note:
- Multiple modes can be enabled together under `[output.diagrams]`.
- When multiple modes are enabled, mode-suffixed diagram files are written (for example, `graph-dependency.mmd`, `graph-flow.puml`).
- For `output.mermaid`/`output.plantuml`, filename-only values resolve under `output.paths.diagrams_dir`; values containing `/` or `\` resolve relative to `output.paths.root` (or detected project root).
- `output.diagrams.component_config.show_internal=true` adds definition-level symbol nodes/links in component diagrams.
- `output.diagrams.flow_config.entry_points` and `max_depth` bound traversal for flow diagrams.
- Mermaid output is enabled by default; PlantUML is disabled by default unless explicitly enabled.

## CLI

Flags:
- `--config` path to TOML config (default `./data/config/circular.toml`)
- default discovery fallback order:
  - `./data/config/circular.toml`
  - `./circular.toml` (deprecated legacy)
  - `./data/config/circular.example.toml`
  - `./circular.example.toml`
- `--once` run one scan and exit
- `--ui` start terminal UI mode
- `--trace` print shortest import chain from one module to another, then exit
- `--impact` analyze direct/transitive impact for a file path or module, then exit
- `--report-md` generate markdown analysis report output
- `--sarif <path>` write a SARIF v2.1.0 report (overrides `output.sarif`); compatible with GitHub Code Scanning
- `--scan-history N` scan the last N git commits for deleted secrets (overrides `secrets.scan_history`; 0 = disabled)
- `--verify-grammars` verify enabled language grammar artifacts and exit
- `--include-tests` include test files in analysis (default excludes tests)
- `--verbose` enable debug logs
- `--version` print version and exit

Positional arg:
- first positional argument overrides `watch_paths` with a single path
- in trace mode, exactly two positional arguments are required (`<from> <to>`)

Version in source: `1.0.0` (`internal/ui/cli/cli.go`).

## Configuration

Primary config file is TOML.

Example (`data/config/circular.example.toml`):

```toml
version = 2

grammars_path = "./grammars"
watch_paths = ["./src"]

[grammar_verification]
enabled = true

[paths]
project_root = ""
config_dir = "data/config"
state_dir = "data/state"
cache_dir = "data/cache"
database_dir = "data/database"

[config]
active_file = "circular.toml"
includes = []

[db]
enabled = true
driver = "sqlite"
path = "history.db"
# shared SQLite store for history snapshots and persistent symbol index
busy_timeout = "5s"
project_mode = "multi"

[projects]
active = ""
registry_file = "projects.toml"

[[projects.entries]]
name = "default"
root = "."
db_namespace = "default"
config_file = "circular.toml"

[mcp]
enabled = false
mode = "embedded"
transport = "stdio"
address = "127.0.0.1:8765"
config_path = "circular.toml"
openapi_spec_path = ""
openapi_spec_url = ""
server_name = "circular"
server_version = "1.0.0"
exposed_tool_name = ""
operation_allowlist = ["scan.run", "secrets.scan", "secrets.list", "graph.cycles", "graph.sync_diagrams", "query.modules", "query.module_details", "query.trace", "system.sync_config", "system.select_project", "query.trends", "report.generate_markdown"]
max_response_items = 500
request_timeout = "30s"
allow_mutations = false
auto_manage_outputs = true
auto_sync_config = true

[languages]
# Optional per-language overrides. Go/Python are enabled by default.

# [languages.javascript]
# enabled = true
# extensions = [".js", ".cjs", ".mjs"]
# [languages.java]
# enabled = true
# [languages.rust]
# enabled = true

[exclude]
dirs = [".git", "node_modules", "vendor", "__pycache__"]
files = ["*.tmp", "*.log"]
# Add entries here to suppress known-safe, project-specific unresolved references.
# This is intended for per-project configs (for example MCP server deployments).
symbols = ["self", "ctx", "p", "log", "toml", "sitter", "tea", "fsnotify"]
# Add entries here to suppress noisy unused-import detections for known-safe imports.
imports = ["fmt", "sort", "strings"]

[watch]
debounce = "1s"

[secrets]
enabled = false
entropy_threshold = 4.0
min_token_length = 20

[[secrets.patterns]]
name = "custom-token"
regex = "CTK_[A-Za-z0-9]{20}"
severity = "medium"

[secrets.exclude]
dirs = []
files = []

[resolver.bridge_scoring]
confirmed_threshold = 8
probable_threshold = 5
weight_explicit_rule_match = 10
weight_bridge_context = 4
weight_bridge_import_evidence = 3
weight_unique_cross_language_match = 2
weight_ambiguous_cross_language_match = -2
weight_local_or_module_conflict = -4
weight_stdlib_conflict = -3

[output]
dot = "graph.dot"
tsv = "dependencies.tsv"
mermaid = "graph.mmd"
# plantuml = "graph.puml"
markdown = "analysis-report.md"

[output.formats]
mermaid = true
plantuml = false

[output.report]
verbosity = "standard"
table_of_contents = true
collapsible_sections = true
include_mermaid = false

[output.diagrams]
architecture = false
component = false
flow = false

[output.diagrams.flow_config]
entry_points = ["cmd/circular/main.go"]
max_depth = 8

[output.diagrams.component_config]
show_internal = false

[output.paths]
root = ""
diagrams_dir = "docs/diagrams"

[[output.update_markdown]]
file = "README.md"
marker = "deps-mermaid"
format = "mermaid"

[[output.update_markdown]]
file = "README.md"
marker = "deps-plantuml"
format = "plantuml"

[alerts]
beep = true
terminal = true

[architecture]
enabled = false
top_complexity = 5

[[architecture.layers]]
name = "api"
paths = ["internal/api", "cmd"]

[[architecture.layers]]
name = "core"
paths = ["internal/core", "internal/engine/graph", "internal/engine/parser", "internal/engine/resolver"]

[[architecture.rules]]
name = "api-to-core-only"
from = "api"
allow = ["core"]

[[architecture.rules]]
name = "core-self-only"
from = "core"
allow = ["core"]
```

Optional explicit bridge mapping file (`.circular-bridge.toml` in any configured watch root):

```toml
[[bridges]]
from = "go:internal/mcp/runtime"
to = "python:circular_mcp.server"
reason = "JSON-RPC over stdio"
references = ["circular_mcp.server.*"]
```

## Outputs

- DOT graph (default `graph.dot`) for visual inspection in Graphviz tools
- TSV import edges (default `dependencies.tsv`) with columns:
  - `From`, `To`, `File`, `Line`, `Column`
- Mermaid graph (optional `graph.mmd`) using `flowchart LR`
- PlantUML graph (optional `graph.puml`) using component/package view
- Markdown report (optional `analysis-report.md`) with frontmatter, summary table, and issue sections
- Mermaid/PlantUML diagram mode is controlled by `[output.diagrams]`:
  - default dependency graph
  - architecture layer graph (`architecture=true`)
  - component relationship graph (`component=true`)
  - bounded flow graph (`flow=true`)
- Multiple enabled modes write mode-suffixed files based on configured output path(s).
- Optional markdown diagram injection via `[[output.update_markdown]]` markers:
  - `<!-- circular:<marker>:start -->`
  - `<!-- circular:<marker>:end -->`
- TSV unused import rows appended when findings exist:
  - `Type`, `File`, `Language`, `Module`, `Alias`, `Item`, `Line`, `Column`, `Confidence`
- TSV probable bridge rows appended when findings exist:
  - `Type`, `File`, `Reference`, `Line`, `Column`, `Confidence`, `Score`, `Reasons`
- TSV architecture violation rows appended when findings exist:
  - `Type`, `Rule`, `FromModule`, `FromLayer`, `ToModule`, `ToLayer`, `File`, `Line`, `Column`
- TSV secret rows appended when findings exist (masked value only):
  - `Type`, `Kind`, `Severity`, `Value`, `Entropy`, `Confidence`, `File`, `Line`, `Column`
- SARIF v2.1.0 JSON report (`output.sarif` or `--sarif`) with:
  - `CIRC001` (circular dependency — error)
  - `CIRC002` (potential secret — error/warning/note by severity)
  - `CIRC003` (architecture violation — warning)
  - All file URIs are relative to project root; `uriBaseId=%SRCROOT%` for GitHub Code Scanning compatibility
- row ordering in DOT/TSV is map-iteration based and not guaranteed stable
- DOT module labels may include metrics:
  - `d=<depth> in=<fan-in> out=<fan-out>`
  - `cx=<top-complexity-score-in-module>`

## Dependency Diagrams

Mermaid:

<!-- circular:deps-mermaid:start -->
```mermaid
%%{init: {'theme': 'base', 'themeVariables': {'textColor': '#000000', 'primaryTextColor': '#000000', 'lineColor': '#333333'}, 'flowchart': {'nodeSpacing': 80, 'rankSpacing': 110, 'curve': 'basis'}}}%%
flowchart LR
  circular_cmd_circular["circular/cmd/circular\n(0 funcs, 1 files)\n(d=13 in=0 out=1)\n(imp=1.0)\n(cx=1)"]
  circular_internal_core_app["circular/internal/core/app\n(0 funcs, 14 files)\n(d=11 in=1 out=13)\n(imp=15.0)\n(cx=1)"]
  circular_internal_core_app_helpers["circular/internal/core/app/helpers\n(0 funcs, 5 files)\n(d=10 in=1 out=7)\n(imp=9.0)"]
  circular_internal_core_config["circular/internal/core/config\n(0 funcs, 5 files)\n(d=1 in=4 out=2)\n(imp=10.0)"]
  circular_internal_core_config_helpers["circular/internal/core/config/helpers\n(0 funcs, 1 files)\n(d=0 in=1 out=0)\n(imp=2.0)"]
  circular_internal_core_errors["circular/internal/core/errors\n(0 funcs, 1 files)\n(d=0 in=3 out=0)\n(imp=6.0)"]
  circular_internal_core_ports["circular/internal/core/ports\n(0 funcs, 1 files)\n(d=6 in=6 out=5)\n(imp=17.0)"]
  circular_internal_core_watcher["circular/internal/core/watcher\n(0 funcs, 1 files)\n(d=0 in=1 out=0)\n(imp=2.0)"]
  circular_internal_data_history["circular/internal/data/history\n(0 funcs, 6 files)\n(d=0 in=7 out=0)\n(imp=14.0)"]
  circular_internal_data_query["circular/internal/data/query\n(0 funcs, 3 files)\n(d=5 in=3 out=2)\n(imp=8.0)"]
  circular_internal_engine_graph["circular/internal/engine/graph\n(0 funcs, 12 files)\n(d=4 in=8 out=2)\n(imp=18.0)"]
  circular_internal_engine_parser["circular/internal/engine/parser\n(0 funcs, 15 files)\n(d=3 in=10 out=4)\n(imp=24.0)"]
  circular_internal_engine_parser_extractors["circular/internal/engine/parser/extractors\n(0 funcs, 1 files)\n(d=4 in=0 out=1)\n(imp=1.0)"]
  circular_internal_engine_parser_grammar["circular/internal/engine/parser/grammar\n(0 funcs, 3 files)\n(d=2 in=1 out=1)\n(imp=3.0)"]
  circular_internal_engine_parser_registry["circular/internal/engine/parser/registry\n(0 funcs, 1 files)\n(d=1 in=2 out=1)\n(imp=5.0)"]
  circular_internal_engine_resolver["circular/internal/engine/resolver\n(0 funcs, 10 files)\n(d=5 in=4 out=3)\n(imp=11.0)"]
  circular_internal_engine_resolver_drivers["circular/internal/engine/resolver/drivers\n(0 funcs, 5 files)\n(d=0 in=1 out=0)\n(imp=2.0)"]
  circular_internal_engine_secrets["circular/internal/engine/secrets\n(0 funcs, 3 files)\n(d=7 in=5 out=2)\n(imp=12.0)"]
  circular_internal_mcp_adapters["circular/internal/mcp/adapters\n(0 funcs, 1 files)\n(d=8 in=5 out=7)\n(imp=17.0)"]
  circular_internal_mcp_contracts["circular/internal/mcp/contracts\n(0 funcs, 1 files)\n(d=0 in=12 out=0)\n(imp=24.0)"]
  circular_internal_mcp_openapi["circular/internal/mcp/openapi\n(0 funcs, 3 files)\n(d=1 in=1 out=1)\n(imp=13.0)"]
  circular_internal_mcp_registry["circular/internal/mcp/registry\n(0 funcs, 1 files)\n(d=0 in=1 out=0)\n(imp=2.0)"]
  circular_internal_mcp_runtime["circular/internal/mcp/runtime\n(0 funcs, 5 files)\n(d=10 in=1 out=16)\n(imp=18.0)"]
  circular_internal_mcp_schema["circular/internal/mcp/schema\n(0 funcs, 1 files)\n(d=1 in=1 out=1)\n(imp=3.0)"]
  circular_internal_mcp_tools_graph["circular/internal/mcp/tools/graph\n(0 funcs, 1 files)\n(d=9 in=1 out=2)\n(imp=4.0)"]
  circular_internal_mcp_tools_overlays["circular/internal/mcp/tools/overlays\n(0 funcs, 1 files)\n(d=5 in=0 out=1)\n(imp=1.0)"]
  circular_internal_mcp_tools_query["circular/internal/mcp/tools/query\n(0 funcs, 1 files)\n(d=9 in=1 out=2)\n(imp=4.0)"]
  circular_internal_mcp_tools_report["circular/internal/mcp/tools/report\n(0 funcs, 1 files)\n(d=1 in=1 out=1)\n(imp=3.0)"]
  circular_internal_mcp_tools_scan["circular/internal/mcp/tools/scan\n(0 funcs, 1 files)\n(d=9 in=1 out=2)\n(imp=4.0)"]
  circular_internal_mcp_tools_secrets["circular/internal/mcp/tools/secrets\n(0 funcs, 1 files)\n(d=9 in=1 out=2)\n(imp=4.0)"]
  circular_internal_mcp_tools_system["circular/internal/mcp/tools/system\n(0 funcs, 1 files)\n(d=1 in=1 out=1)\n(imp=3.0)"]
  circular_internal_mcp_transport["circular/internal/mcp/transport\n(0 funcs, 1 files)\n(d=2 in=1 out=2)\n(imp=4.0)"]
  circular_internal_mcp_validate["circular/internal/mcp/validate\n(0 funcs, 1 files)\n(d=1 in=1 out=1)\n(imp=3.0)"]
  circular_internal_shared_util["circular/internal/shared/util\n(0 funcs, 1 files)\n(d=0 in=8 out=0)\n(imp=16.0)"]
  circular_internal_shared_version["circular/internal/shared/version\n(0 funcs, 1 files)\n(d=0 in=4 out=0)\n(imp=8.0)"]
  circular_internal_ui_cli["circular/internal/ui/cli\n(0 funcs, 7 files)\n(d=12 in=1 out=13)\n(imp=15.0)"]
  circular_internal_ui_report["circular/internal/ui/report\n(0 funcs, 4 files)\n(d=9 in=3 out=3)\n(imp=9.0)"]
  circular_internal_ui_report_formats["circular/internal/ui/report/formats\n(0 funcs, 10 files)\n(d=8 in=2 out=6)\n(imp=10.0)"]
  __external_aggregate__["External/Stdlib\n(48 modules)"]

  classDef internalNode fill:#f7fbff,stroke:#4d6480,stroke-width:1px,color:#000000;
  class circular_cmd_circular,circular_internal_core_app,circular_internal_core_app_helpers,circular_internal_core_config,circular_internal_core_config_helpers,circular_internal_core_errors,circular_internal_core_ports,circular_internal_core_watcher,circular_internal_data_history,circular_internal_data_query,circular_internal_engine_graph,circular_internal_engine_parser,circular_internal_engine_parser_extractors,circular_internal_engine_parser_grammar,circular_internal_engine_parser_registry,circular_internal_engine_resolver,circular_internal_engine_resolver_drivers,circular_internal_engine_secrets,circular_internal_mcp_adapters,circular_internal_mcp_contracts,circular_internal_mcp_openapi,circular_internal_mcp_registry,circular_internal_mcp_runtime,circular_internal_mcp_schema,circular_internal_mcp_tools_graph,circular_internal_mcp_tools_overlays,circular_internal_mcp_tools_query,circular_internal_mcp_tools_report,circular_internal_mcp_tools_scan,circular_internal_mcp_tools_secrets,circular_internal_mcp_tools_system,circular_internal_mcp_transport,circular_internal_mcp_validate,circular_internal_shared_util,circular_internal_shared_version,circular_internal_ui_cli,circular_internal_ui_report,circular_internal_ui_report_formats internalNode;
  classDef externalNode fill:#efefef,stroke:#808080,stroke-dasharray:4 3,color:#000000;
  class __external_aggregate__ externalNode;
  classDef hotspotNode stroke:#8a4f00,stroke-width:2px,color:#000000;
  class circular_cmd_circular,circular_internal_core_app hotspotNode;

  circular_cmd_circular --> circular_internal_ui_cli
  circular_internal_core_app --> circular_internal_core_app_helpers
  circular_internal_core_app --> circular_internal_core_config
  circular_internal_core_app --> circular_internal_core_errors
  circular_internal_core_app --> circular_internal_core_ports
  circular_internal_core_app --> circular_internal_core_watcher
  circular_internal_core_app --> circular_internal_data_history
  circular_internal_core_app --> circular_internal_data_query
  circular_internal_core_app --> circular_internal_engine_graph
  circular_internal_core_app --> circular_internal_engine_parser
  circular_internal_core_app --> circular_internal_engine_resolver
  circular_internal_core_app --> circular_internal_engine_secrets
  circular_internal_core_app --> circular_internal_shared_version
  circular_internal_core_app --> circular_internal_ui_report
  circular_internal_core_app_helpers --> circular_internal_core_config
  circular_internal_core_app_helpers --> circular_internal_core_ports
  circular_internal_core_app_helpers --> circular_internal_engine_graph
  circular_internal_core_app_helpers --> circular_internal_engine_parser
  circular_internal_core_app_helpers --> circular_internal_engine_secrets
  circular_internal_core_app_helpers --> circular_internal_shared_util
  circular_internal_core_app_helpers --> circular_internal_ui_report
  circular_internal_core_config --> circular_internal_core_config_helpers
  circular_internal_core_config --> circular_internal_shared_version
  circular_internal_core_ports --> circular_internal_data_history
  circular_internal_core_ports --> circular_internal_data_query
  circular_internal_core_ports --> circular_internal_engine_graph
  circular_internal_core_ports --> circular_internal_engine_parser
  circular_internal_core_ports --> circular_internal_engine_resolver
  circular_internal_data_query --> circular_internal_data_history
  circular_internal_data_query --> circular_internal_engine_graph
  circular_internal_engine_graph --> circular_internal_engine_parser
  circular_internal_engine_graph --> circular_internal_shared_util
  circular_internal_engine_parser --> circular_internal_core_errors
  circular_internal_engine_parser --> circular_internal_engine_parser_grammar
  circular_internal_engine_parser --> circular_internal_engine_parser_registry
  circular_internal_engine_parser --> circular_internal_shared_util
  circular_internal_engine_parser_extractors --> circular_internal_engine_parser
  circular_internal_engine_parser_grammar --> circular_internal_engine_parser_registry
  circular_internal_engine_parser_registry --> circular_internal_shared_util
  circular_internal_engine_resolver --> circular_internal_engine_graph
  circular_internal_engine_resolver --> circular_internal_engine_parser
  circular_internal_engine_resolver --> circular_internal_engine_resolver_drivers
  circular_internal_engine_secrets --> circular_internal_core_ports
  circular_internal_engine_secrets --> circular_internal_engine_parser
  circular_internal_mcp_adapters --> circular_internal_core_errors
  circular_internal_mcp_adapters --> circular_internal_core_ports
  circular_internal_mcp_adapters --> circular_internal_data_history
  circular_internal_mcp_adapters --> circular_internal_engine_parser
  circular_internal_mcp_adapters --> circular_internal_engine_secrets
  circular_internal_mcp_adapters --> circular_internal_mcp_contracts
  circular_internal_mcp_adapters --> circular_internal_shared_util
  circular_internal_mcp_openapi --> circular_internal_mcp_contracts
  circular_internal_mcp_runtime --> circular_internal_core_config
  circular_internal_mcp_runtime --> circular_internal_core_ports
  circular_internal_mcp_runtime --> circular_internal_data_history
  circular_internal_mcp_runtime --> circular_internal_mcp_adapters
  circular_internal_mcp_runtime --> circular_internal_mcp_contracts
  circular_internal_mcp_runtime --> circular_internal_mcp_openapi
  circular_internal_mcp_runtime --> circular_internal_mcp_registry
  circular_internal_mcp_runtime --> circular_internal_mcp_tools_graph
  circular_internal_mcp_runtime --> circular_internal_mcp_tools_query
  circular_internal_mcp_runtime --> circular_internal_mcp_tools_report
  circular_internal_mcp_runtime --> circular_internal_mcp_tools_scan
  circular_internal_mcp_runtime --> circular_internal_mcp_tools_secrets
  circular_internal_mcp_runtime --> circular_internal_mcp_tools_system
  circular_internal_mcp_runtime --> circular_internal_mcp_transport
  circular_internal_mcp_runtime --> circular_internal_mcp_validate
  circular_internal_mcp_runtime --> circular_internal_shared_util
  circular_internal_mcp_schema --> circular_internal_mcp_contracts
  circular_internal_mcp_tools_graph --> circular_internal_mcp_adapters
  circular_internal_mcp_tools_graph --> circular_internal_mcp_contracts
  circular_internal_mcp_tools_overlays --> circular_internal_engine_graph
  circular_internal_mcp_tools_query --> circular_internal_mcp_adapters
  circular_internal_mcp_tools_query --> circular_internal_mcp_contracts
  circular_internal_mcp_tools_report --> circular_internal_mcp_contracts
  circular_internal_mcp_tools_scan --> circular_internal_mcp_adapters
  circular_internal_mcp_tools_scan --> circular_internal_mcp_contracts
  circular_internal_mcp_tools_secrets --> circular_internal_mcp_adapters
  circular_internal_mcp_tools_secrets --> circular_internal_mcp_contracts
  circular_internal_mcp_tools_system --> circular_internal_mcp_contracts
  circular_internal_mcp_transport --> circular_internal_mcp_contracts
  circular_internal_mcp_transport --> circular_internal_mcp_schema
  circular_internal_mcp_validate --> circular_internal_mcp_contracts
  circular_internal_ui_cli --> circular_internal_core_app
  circular_internal_ui_cli --> circular_internal_core_config
  circular_internal_ui_cli --> circular_internal_core_ports
  circular_internal_ui_cli --> circular_internal_data_history
  circular_internal_ui_cli --> circular_internal_data_query
  circular_internal_ui_cli --> circular_internal_engine_parser
  circular_internal_ui_cli --> circular_internal_engine_resolver
  circular_internal_ui_cli --> circular_internal_engine_secrets
  circular_internal_ui_cli --> circular_internal_mcp_runtime
  circular_internal_ui_cli --> circular_internal_shared_util
  circular_internal_ui_cli --> circular_internal_shared_version
  circular_internal_ui_cli --> circular_internal_ui_report
  circular_internal_ui_cli --> circular_internal_ui_report_formats
  circular_internal_ui_report --> circular_internal_data_history
  circular_internal_ui_report --> circular_internal_engine_graph
  circular_internal_ui_report --> circular_internal_ui_report_formats
  circular_internal_ui_report_formats --> circular_internal_engine_graph
  circular_internal_ui_report_formats --> circular_internal_engine_parser
  circular_internal_ui_report_formats --> circular_internal_engine_resolver
  circular_internal_ui_report_formats --> circular_internal_engine_secrets
  circular_internal_ui_report_formats --> circular_internal_shared_util
  circular_internal_ui_report_formats --> circular_internal_shared_version
  circular_cmd_circular -->|ext:1| __external_aggregate__
  circular_internal_core_app -->|ext:11| __external_aggregate__
  circular_internal_core_app_helpers -->|ext:6| __external_aggregate__
  circular_internal_core_config -->|ext:7| __external_aggregate__
  circular_internal_core_config_helpers -->|ext:3| __external_aggregate__
  circular_internal_core_errors -->|ext:2| __external_aggregate__
  circular_internal_core_ports -->|ext:2| __external_aggregate__
  circular_internal_core_watcher -->|ext:8| __external_aggregate__
  circular_internal_data_history -->|ext:12| __external_aggregate__
  circular_internal_data_query -->|ext:7| __external_aggregate__
  circular_internal_engine_graph -->|ext:14| __external_aggregate__
  circular_internal_engine_parser -->|ext:19| __external_aggregate__
  circular_internal_engine_parser_grammar -->|ext:10| __external_aggregate__
  circular_internal_engine_parser_registry -->|ext:4| __external_aggregate__
  circular_internal_engine_resolver -->|ext:9| __external_aggregate__
  circular_internal_engine_resolver_drivers -->|ext:5| __external_aggregate__
  circular_internal_engine_secrets -->|ext:11| __external_aggregate__
  circular_internal_mcp_adapters -->|ext:8| __external_aggregate__
  circular_internal_mcp_contracts -->|ext:1| __external_aggregate__
  circular_internal_mcp_openapi -->|ext:10| __external_aggregate__
  circular_internal_mcp_registry -->|ext:3| __external_aggregate__
  circular_internal_mcp_runtime -->|ext:8| __external_aggregate__
  circular_internal_mcp_tools_graph -->|ext:1| __external_aggregate__
  circular_internal_mcp_tools_overlays -->|ext:4| __external_aggregate__
  circular_internal_mcp_tools_query -->|ext:4| __external_aggregate__
  circular_internal_mcp_tools_report -->|ext:1| __external_aggregate__
  circular_internal_mcp_tools_scan -->|ext:1| __external_aggregate__
  circular_internal_mcp_tools_secrets -->|ext:1| __external_aggregate__
  circular_internal_mcp_tools_system -->|ext:1| __external_aggregate__
  circular_internal_mcp_transport -->|ext:8| __external_aggregate__
  circular_internal_mcp_validate -->|ext:3| __external_aggregate__
  circular_internal_shared_util -->|ext:6| __external_aggregate__
  circular_internal_ui_cli -->|ext:15| __external_aggregate__
  circular_internal_ui_report -->|ext:6| __external_aggregate__
  circular_internal_ui_report_formats -->|ext:7| __external_aggregate__

  linkStyle 105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139 stroke:#777777,stroke-dasharray:4 3;

  subgraph legend_info["Legend"]
    legend_metrics["Node line 1: module\nline 2: funcs/files\n(d=depth in=fan-in out=fan-out)\n(cx=complexity hotspot score)"]
    legend_edges["Edge labels: CYCLE=import cycle, VIOLATION=architecture rule violation, ext:N=external dependency count"]
  end
  classDef legendNode fill:#fff8dc,stroke:#b8a24c,stroke-width:1px,color:#000000;
  class legend_metrics,legend_edges legendNode;
```
<!-- circular:deps-mermaid:end -->

PlantUML:

<!-- circular:deps-plantuml:start -->
```plantuml

```
<!-- circular:deps-plantuml:end -->

## Documentation

Full documentation is in `docs/documentation/`:
- `docs/documentation/README.md`
- `docs/documentation/cli.md`
- `docs/documentation/configuration.md`
- `docs/documentation/output.md`
- `docs/documentation/architecture.md`
- `docs/documentation/packages.md`
- `docs/documentation/limitations.md`
- `docs/documentation/ai-audit.md`

AI audit reports are in `docs/reviews/`:
- `docs/reviews/performance-security-review-2026-02-12.md`

## Project Layout

- `cmd/circular/` CLI app, orchestration, TUI
- `internal/core/config/` TOML config loading
- `internal/engine/parser/` Tree-sitter parsing and extractors
- `internal/engine/parser/registry/` language registry defaults/override validation
- `internal/engine/parser/grammar/` grammar manifest loading and artifact verification
- `internal/engine/parser/extractors/` extractor wrapper constructors
- `internal/engine/graph/` dependency graph + cycle detection
- `internal/engine/resolver/` unresolved reference detection
- `internal/engine/resolver/drivers/` language-specific resolver drivers
- `internal/core/watcher/` fsnotify watch + debounce
- `internal/mcp/runtime/` MCP runtime bootstrap + project context sync
- `internal/ui/report/` DOT/TSV/Mermaid/PlantUML/Markdown generators + markdown injection
- `internal/ui/report/formats/` report format generators (DOT/TSV/Mermaid/PlantUML/Markdown)
