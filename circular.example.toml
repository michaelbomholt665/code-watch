# circular.example.toml
# Deprecated location: prefer data/config/circular.example.toml and
# use --config ./data/config/circular.toml (or keep default discovery).

# Configuration Versioning & Environment Overrides
# -----------------------------------------------
# Circular supports versioned configuration schemas (currently version 2).
# All settings can be overridden using environment variables following the 
# pattern: CIRCULAR_[SECTION]_[KEY].
# Examples:
#   CIRCULAR_OBSERVABILITY_PORT=9090
#   CIRCULAR_WATCH_DEBOUNCE=2s
#   CIRCULAR_DB_ENABLED=true
#   CIRCULAR_MCP_TRANSPORT=http
#   CIRCULAR_MCP_ADDRESS=0.0.0.0:8080

version = 2

grammars_path = "./grammars"
watch_paths = ["./src"]

[grammar_verification]
enabled = true

[paths]
project_root = ""
config_dir = "data/config"
state_dir = "data/state"
cache_dir = "data/cache"
database_dir = "data/database"

[config]
active_file = "circular.toml"
includes = []

[db]
enabled = true
driver = "sqlite"
path = "history.db"
busy_timeout = "5s"
project_mode = "multi"

[projects]
active = ""
registry_file = "projects.toml"

[[projects.entries]]
name = "default"
root = "."
db_namespace = "default"
config_file = "circular.toml"

[mcp]
enabled = false
mode = "embedded"
transport = "stdio"
address = "127.0.0.1:8765"
config_path = "circular.toml"
server_name = "circular"
server_version = "1.0.0"
exposed_tool_name = ""
operation_allowlist = ["scan.run", "secrets.scan", "secrets.list", "graph.cycles", "query.modules", "query.module_details", "query.trace", "system.sync_outputs", "system.sync_config", "system.select_project", "query.trends", "report.generate_markdown"]
max_response_items = 500
request_timeout = "30s"
allow_mutations = false
auto_manage_outputs = true
auto_sync_config = true

[languages]
# Optional per-language rollout overrides.
# Defaults: go=true, python=true, all others=false.

# [languages.css]
# enabled = false
# extensions = [".css"]

# [languages.go]
# enabled = true
# extensions = [".go"]

# [languages.gomod]
# enabled = false
# filenames = ["go.mod"]

# [languages.gosum]
# enabled = false
# filenames = ["go.sum"]

# [languages.html]
# enabled = false
# extensions = [".html", ".htm"]

# [languages.javascript]
# enabled = false
# extensions = [".js", ".cjs", ".mjs"]

# [languages.java]
# enabled = false
# extensions = [".java"]

# [languages.python]
# enabled = true
# extensions = [".py"]

# [languages.rust]
# enabled = false
# extensions = [".rs"]

# [languages.tsx]
# enabled = false
# extensions = [".tsx"]

# [languages.typescript]
# enabled = false
# extensions = [".ts"]

[exclude]
dirs = [".git", "node_modules", "vendor", "__pycache__"]
files = ["*.tmp", "*.log"]
# Add entries here to suppress known-safe, project-specific unresolved references.
# This is intended for per-project configs (for example MCP server deployments).
# Prefer module/package names and stable aliases; keep list minimal.
symbols = [
  "self",
  "ctx",
  "p",
  "log",
  "toml",
  "sitter",
  "tea",
  "fsnotify",
  "query",
  "history",
  "statusStyle",
  "cycleStyle",
  "tree_sitter",
  "tree_sitter_css",
  "tree_sitter_go",
  "tree_sitter_html",
  "tree_sitter_java",
  "tree_sitter_javascript",
  "tree_sitter_python",
  "tree_sitter_rust",
  "tree_sitter_typescript",
]
# Add entries here to suppress noisy unused-import detections for known-safe imports.
# Use fully-qualified module paths or common stdlib packages. Keep list minimal.
imports = [
  "fmt",
  "sort",
  "strings",
  "os",
  "os/exec",
  "time",
  "sync",
  "context",
  "path",
  "path/filepath",
  "unicode",
  "errors",
  "io",
  "io/fs",
  "embed",
  "encoding/json",
  "circular/internal/engine/resolver",
  "circular/internal/shared/util",
  "circular/internal/data/query",
  "circular/internal/ui/report",
  "circular/internal/ui/report/formats",
  "github.com/charmbracelet/bubbles/list",
  "github.com/charmbracelet/bubbletea",
  "github.com/charmbracelet/lipgloss",
  "github.com/tree-sitter/go-tree-sitter",
  "github.com/gobwas/glob",
]

[watch]
debounce = "1s"

[secrets]
enabled = false
entropy_threshold = 4.0
min_token_length = 20

[[secrets.patterns]]
name = "custom-token"
regex = "CTK_[A-Za-z0-9]{20}"
severity = "medium"

[secrets.exclude]
dirs = []
files = []

[resolver.bridge_scoring]
confirmed_threshold = 8
probable_threshold = 5
weight_explicit_rule_match = 10
weight_bridge_context = 4
weight_bridge_import_evidence = 3
weight_unique_cross_language_match = 2
weight_ambiguous_cross_language_match = -2
weight_local_or_module_conflict = -4
weight_stdlib_conflict = -3

[caches]
# LRU cache capacity for parsed files. 
# Increasing this improves analysis speed but uses more memory.
files = 1000
# LRU cache capacity for raw file contents.
file_contents = 1000

[observability]
# Set to true to enable the observability HTTP server (metrics and health).
enabled = false
# HTTP port for the metrics and health endpoints.
port = 9090
# Enable Prometheus metrics export.
enable_metrics = true
# Enable OpenTelemetry tracing.
enable_tracing = false
# OTLP collector endpoint (gRPC).
otlp_endpoint = "localhost:4317"
# Service name for traces and metrics.
service_name = "circular"

[output]
dot = "graph.dot"
tsv = "dependencies.tsv"
mermaid = "graph.mmd"
# Set to generate PlantUML outputs when desired.
# plantuml = "graph.puml"
markdown = "analysis-report.md"

[output.formats]
mermaid = true
plantuml = false

[output.report]
verbosity = "standard"
table_of_contents = true
collapsible_sections = true
include_mermaid = false

[output.diagrams]
# Enable one or more dedicated modes. When multiple are enabled, circular writes
# mode-suffixed files (for example, graph-dependency.mmd, graph-flow.mmd).
architecture = false
component = false
flow = false

[output.diagrams.flow_config]
# Flow mode starts from matched module names or file paths and traverses imports up to max_depth.
entry_points = ["cmd/circular/main.go"]
max_depth = 8

[output.diagrams.component_config]
# When true, component diagrams include definition-level symbol nodes and reference previews.
show_internal = false

[output.paths]
root = ""
diagrams_dir = "docs/diagrams"

[[output.update_markdown]]
file = "README.md"
marker = "deps-mermaid"
format = "mermaid"

[[output.update_markdown]]
file = "README.md"
marker = "deps-plantuml"
format = "plantuml"

[alerts]
beep = true
terminal = true

[architecture]
enabled = false
top_complexity = 5

[[architecture.layers]]
name = "api"
paths = ["internal/api", "cmd"]

[[architecture.layers]]
name = "core"
paths = ["internal/core", "internal/engine/graph", "internal/engine/parser", "internal/engine/resolver"]

[[architecture.rules]]
name = "api-to-core-only"
from = "api"
allow = ["core"]

[[architecture.rules]]
name = "core-self-only"
from = "core"
allow = ["core"]

[[architecture.rules]]
name = "api-size"
kind = "package"
modules = ["internal/api"]
max_files = 30
exclude = { tests = true, files = ["index.ts", "__init__.py"] }

[[architecture.rules]]
name = "api-imports"
kind = "package"
modules = ["internal/api"]
imports = { allow = ["internal/core/**"], deny = ["internal/engine/**"] }
